<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:POS.Avalonia.ViewModels"
             xmlns:core="using:POS.Core.Models"
             xmlns:controls="using:POS.Avalonia.Controls"
             x:Class="POS.Avalonia.Views.EmployeeManagementView"
             x:Name="Root"
             x:DataType="vm:EmployeeManagementViewModel">
  <Grid RowDefinitions="Auto,*" Margin="0">
    <StackPanel Grid.Row="0" Spacing="{DynamicResource Spacing16}" Margin="0,0,0,20">
      <controls:PageTitle Title="Employee management">
        <StackPanel Orientation="Horizontal" Spacing="{DynamicResource Spacing8}">
          <Button Content="Refresh" Command="{Binding LoadCommand}"/>
          <Button Content="Add employee" Command="{Binding OpenAddCommand}" Classes="primary"/>
        </StackPanel>
      </controls:PageTitle>
    </StackPanel>
    <Border Grid.Row="1" Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1" CornerRadius="{DynamicResource CornerRadius12}" Padding="16">
      <StackPanel Spacing="8">
        <TextBlock Text="Employees" FontSize="{DynamicResource SubtitleFontSize}"
                   FontWeight="{StaticResource SubtitleFontWeight}" Foreground="{StaticResource OnSurfaceBrush}"/>
        <ListBox ItemsSource="{Binding Employees}" SelectedItem="{Binding SelectedEmployee}" MinHeight="320"
                 Background="{StaticResource SurfaceBrush}" BorderThickness="0">
          <ListBox.ItemTemplate>
            <DataTemplate DataType="core:Employee">
              <Border Padding="12,10" Margin="0,2" CornerRadius="8">
                <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                  <TextBlock Grid.Column="0" Text="{Binding Fullname}" VerticalAlignment="Center"
                             FontSize="{DynamicResource BodyFontSize}" Foreground="{StaticResource OnSurfaceBrush}"/>
                  <TextBlock Grid.Column="1" Text="{Binding Username}" VerticalAlignment="Center" Margin="16,0,0,0"
                             FontSize="{DynamicResource CaptionFontSize}" Foreground="{StaticResource OnSurfaceMutedBrush}"/>
                  <TextBlock Grid.Column="2" Text="{Binding Role}" VerticalAlignment="Center" Margin="8,0,0,0"
                             FontSize="{DynamicResource CaptionFontSize}" Foreground="{StaticResource SecondaryBrush}"/>
                  <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="8" Margin="16,0,0,0">
                    <Button Content="Edit" Command="{Binding #Root.DataContext.OpenEditCommand}" CommandParameter="{Binding}" Padding="10,6" FontSize="{DynamicResource CaptionFontSize}"/>
                    <Button Content="Delete" Command="{Binding #Root.DataContext.RequestDeleteCommand}" CommandParameter="{Binding}" Padding="10,6" FontSize="{DynamicResource CaptionFontSize}"/>
                  </StackPanel>
                </Grid>
              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
      </StackPanel>
    </Border>
    <!-- Edit overlay -->
    <Border Grid.Row="0" Grid.RowSpan="2" IsVisible="{Binding IsEditOpen}" Background="{StaticResource OverlayDimBrush}" ZIndex="100">
      <Border HorizontalAlignment="Center" VerticalAlignment="Center" Background="{StaticResource SurfaceBrush}"
              Padding="24" CornerRadius="{DynamicResource CornerRadius12}" MinWidth="320"
              BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
        <StackPanel Spacing="{DynamicResource Spacing16}">
          <TextBlock Text="Employee" FontSize="{DynamicResource SubtitleFontSize}" FontWeight="{StaticResource SubtitleFontWeight}" Foreground="{StaticResource OnSurfaceBrush}"/>
          <TextBox Text="{Binding FormFullname}" Watermark="Full name"/>
          <TextBox Text="{Binding FormUsername}" Watermark="Username"/>
          <TextBox Text="{Binding FormPassword}" Watermark="Password (leave blank to keep)" PasswordChar="*"/>
          <TextBox Text="{Binding FormPhoneNumber}" Watermark="Phone"/>
          <ComboBox ItemsSource="{Binding Roles}" SelectedItem="{Binding FormRole}" MinWidth="120"/>
          <TextBox Text="{Binding FormGender}" Watermark="Gender"/>
          <TextBox Text="{Binding FormAddress}" Watermark="Address"/>
          <TextBox Text="{Binding FormDob}" Watermark="Date of birth"/>
          <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
            <Button Content="Save" Command="{Binding SaveCommand}" Classes="primary"/>
            <Button Content="Cancel" Command="{Binding CloseEditCommand}"/>
          </StackPanel>
        </StackPanel>
      </Border>
    </Border>
    <!-- Delete confirm overlay -->
    <Border Grid.Row="0" Grid.RowSpan="2" IsVisible="{Binding IsDeleteConfirmOpen}" Background="{StaticResource OverlayDimBrush}" ZIndex="101">
      <Border HorizontalAlignment="Center" VerticalAlignment="Center" Background="{StaticResource SurfaceBrush}"
              Padding="24" CornerRadius="{DynamicResource CornerRadius12}" MinWidth="280"
              BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
        <StackPanel Spacing="12">
          <TextBlock Text="Delete employee?" FontSize="{DynamicResource SubtitleFontSize}" FontWeight="SemiBold" Foreground="{StaticResource OnSurfaceBrush}"/>
          <TextBlock Text="{Binding DeleteTarget.Fullname}" FontSize="{DynamicResource BodyFontSize}" Foreground="{StaticResource OnSurfaceMutedBrush}"/>
          <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
            <Button Content="Delete" Command="{Binding ConfirmDeleteCommand}" Classes="primary"/>
            <Button Content="Cancel" Command="{Binding CancelDeleteCommand}"/>
          </StackPanel>
        </StackPanel>
      </Border>
    </Border>
  </Grid>
</UserControl>
