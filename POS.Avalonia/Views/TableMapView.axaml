<UserControl xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:POS.Avalonia.ViewModels" xmlns:models="using:POS.Core.Models"
             xmlns:controls="using:POS.Avalonia.Controls"
             x:Class="POS.Avalonia.Views.TableMapView" x:Name="Root" x:DataType="vm:TableMapViewModel">
  <Grid>
    <StackPanel Margin="24" Spacing="16">
      <controls:PageTitle Title="{Binding Title}">
        <StackPanel Orientation="Horizontal" Spacing="8">
          <Button Content="Refresh" Command="{Binding LoadCommand}"/>
          <Button Content="Add table" Command="{Binding OpenAddTableCommand}" IsVisible="{Binding IsManager}" Padding="8,4"/>
        </StackPanel>
      </controls:PageTitle>
      <ItemsControl ItemsSource="{Binding Tables}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel/>
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate DataType="models:Table">
            <Border Width="100" Height="100" Margin="8" Padding="8"
                    Background="{StaticResource SurfaceBrush}" CornerRadius="8"
                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
              <StackPanel Spacing="4">
                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="14"/>
                <TextBlock Text="{Binding Status}" FontSize="12" Foreground="{StaticResource OnSurfaceMutedBrush}"/>
                <Button Content="New order" Command="{Binding #Root.DataContext.NewOrderAtTableCommand}" CommandParameter="{Binding}"
                        Padding="6,4" FontSize="11" HorizontalAlignment="Stretch"/>
                <StackPanel Orientation="Horizontal" Spacing="4" IsVisible="{Binding #Root.DataContext.IsManager}">
                  <Button Content="Reserve" Command="{Binding #Root.DataContext.ReserveTableCommand}" CommandParameter="{Binding}" Padding="4,2" FontSize="10"/>
                  <Button Content="Edit" Command="{Binding #Root.DataContext.OpenEditTableCommand}" CommandParameter="{Binding}" Padding="4,2" FontSize="10"/>
                  <Button Content="Delete" Command="{Binding #Root.DataContext.DeleteTableCommand}" CommandParameter="{Binding}" Padding="4,2" FontSize="10"/>
                </StackPanel>
              </StackPanel>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </StackPanel>
    <!-- Table edit overlay (manager) -->
    <Border IsVisible="{Binding IsTableEditOpen}" Background="{StaticResource OverlayDimBrush}" ZIndex="100" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
      <Border HorizontalAlignment="Center" VerticalAlignment="Center" Background="{StaticResource SurfaceBrush}" Padding="24" CornerRadius="12" MinWidth="280"
              BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
        <StackPanel Spacing="12">
          <TextBlock Text="Table" FontSize="{DynamicResource SubtitleFontSize}" FontWeight="SemiBold" Foreground="{StaticResource OnSurfaceBrush}"/>
          <TextBox Text="{Binding TableFormName}" Watermark="Name"/>
          <TextBox Text="{Binding TableFormCapacity}" Watermark="Capacity"/>
          <TextBox Text="{Binding TableFormZone}" Watermark="Zone"/>
          <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
            <Button Content="Save" Command="{Binding SaveTableCommand}" Classes="primary"/>
            <Button Content="Cancel" Command="{Binding CloseTableEditCommand}"/>
          </StackPanel>
        </StackPanel>
      </Border>
    </Border>
  </Grid>
</UserControl>
